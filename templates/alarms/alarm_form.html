{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm" style="max-width:860px;margin:0 auto;">
  <div class="card-header bg-white">
    <h4 class="m-0">{% if object %}编辑报警{% else %}新增报警{% endif %}</h4>
  </div>
  <div class="card-body">
    {% if form.errors %}
      <div class="alert alert-danger">请检查表单中的错误。</div>
    {% endif %}
    <form method="post" novalidate>
      {% csrf_token %}
      <div class="row g-3">
        {% if form.device or form.device_id %}
        <div class="col-md-6">
          <label class="form-label">设备<span class="text-danger">*</span></label>
          {% firstof form.device form.device_id as dev %}
          {{ dev }}
        </div>
        {% endif %}

        {% if form.alarm_type or form.type or form.category %}
        <div class="col-md-6">
          {% firstof form.alarm_type form.type form.category as atype %}
          {% if atype %}
          <div class="col-md-6">
            <label class="form-label">类型</label>
            {{ atype }}
          </div>
          {% endif %}
        {% endif %}

        {% if form.status or form.state %}
        <div class="col-md-6">
          <label class="form-label">状态</label>
          {% firstof form.status form.state as st %}
          {{ st }}
        </div>
        {% endif %}

        {% if form.timestamp or form.created_at or form.time %}
        <div class="col-md-6">
          {% firstof form.timestamp form.created_at form.time as ts %}
          {% if ts %}
          <div class="col-md-6">
            <label class="form-label">时间</label>
            {{ ts }}
          </div>
          {% endif %}
        {% endif %}

        {% if form.description or form.message or form.details or form.content or form.note %}
        <div class="col-12">
          <label class="form-label">描述</label>
          {% firstof form.description form.message form.details form.content form.note as desc %}
          {{ desc }}
        </div>
        {% endif %}
      </div>

      {% for f in form.hidden_fields %}{{ f }}{% endfor %}
      <div class="mt-3">
        {% for f in form.visible_fields %}
          {% if f.name != 'device' and f.name != 'device_id' and f.name != 'alarm_type' and f.name != 'type' and f.name != 'category' and f.name != 'status' and f.name != 'state' and f.name != 'timestamp' and f.name != 'created_at' and f.name != 'time' and f.name != 'description' and f.name != 'message' and f.name != 'details' and f.name != 'content' and f.name != 'note' %}
            <div class="mb-2">
              <label class="form-label">{{ f.label }}</label>
              {{ f }}
              {% if f.help_text %}<div class="form-text text-muted">{{ f.help_text }}</div>{% endif %}
              {% if f.errors %}<div class="text-danger small">{{ f.errors }}</div>{% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <div class="d-flex justify-content-end mt-4">
        <a href="{% url 'alarms:list' %}" class="btn btn-outline-secondary me-2">返回</a>
        <button type="submit" class="btn btn-primary">保存</button>
      </div>
    </form>
  </div>
</div>

<script>
(function(){
  document.querySelectorAll('input[type=text],input[type=number],input[type=datetime-local],textarea,select').forEach(function(el){
    if(!el.className || !/form-(control|select)/.test(el.className)){
      if(el.tagName === 'SELECT'){ el.classList.add('form-select'); }
      else { el.classList.add('form-control'); }
    }
  });
})();
</script>
{% endblock %}
