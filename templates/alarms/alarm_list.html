{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>报警记录</h2>
  <div class="mb-3 text-end">
    <a href="{% url 'alarms:add' %}" class="btn btn-success">+ 新建报警</a>
  </div>
  <table class="table table-bordered table-striped align-middle">
    <thead>
      <tr>
        <th>ID</th>
        <th>设备</th>
        <th>状态</th>
        <th>时间</th>
        <th>描述</th>
        {% if perms.alarms.change_alarm or perms.alarms.delete_alarm %}
        <th>操作</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for a in alarms %}
      <tr>
        <td>{{ a.id }}</td>
        <td>{{ a.device }}</td>
        <td>{{ a.status }}</td>
        <td>
          {% firstof a.timestamp a.created_at a.time as t %}
          {% if t %}
            {{ t|date:"Y-m-d H:i" }}
          {% else %}
            --
          {% endif %}
        </td>
        <td>{% if a.description %}{{ a.description }}{% elif a.message %}{{ a.message }}{% elif a.detail %}{{ a.detail }}{% else %}--{% endif %}</td>
        {% if perms.alarms.change_alarm or perms.alarms.delete_alarm %}
        <td>
          {% if perms.alarms.change_alarm %}
            <a href="{% url 'alarms:edit' a.id %}" class="btn btn-sm btn-outline-primary">编辑</a>
          {% endif %}
          {% if perms.alarms.delete_alarm %}
            <a href="{% url 'alarms:delete' a.id %}" class="btn btn-sm btn-outline-danger">删除</a>
          {% endif %}
        </td>
        {% endif %}
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center text-muted">暂无报警记录</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
