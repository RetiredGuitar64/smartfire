{% extends "base.html" %}
{% block title %}报警记录 · 智慧消防{% endblock %}
{% block content %}
<h1 class="mb-4">报警记录</h1>

<form class="mb-3" method="get">
  <label class="form-label me-2">状态筛选：</label>
  <select name="status" class="form-select w-auto d-inline-block">
    <option value="">全部</option>
    <option value="active" {% if status_filter == 'active' %}selected{% endif %}>活跃</option>
    <option value="cleared" {% if status_filter == 'cleared' %}selected{% endif %}>已恢复</option>
  </select>
  <button class="btn btn-primary ms-2" type="submit">筛选</button>
</form>

{% if alarms %}
<div class="table-responsive">
  <table class="table table-striped table-sm align-middle">
    <thead>
      <tr>
        <th>ID</th>
        <th>设备</th>
        <th>级别</th>
        <th>状态</th>
        <th>时间</th>
        <th>消息</th>
      </tr>
    </thead>
    <tbody>
      {% for a in alarms %}
      <tr>
        <td>{{ a.id }}</td>
        <td>{{ a.device.name }}</td>
        <td>
          {% if a.level == 'high' %}
            <span class="badge bg-danger">高</span>
          {% elif a.level == 'medium' %}
            <span class="badge bg-warning text-dark">中</span>
          {% else %}
            <span class="badge bg-info text-dark">低</span>
          {% endif %}
        </td>
        <td>
          {% if a.status == 'active' %}
            <span class="badge bg-danger">活跃</span>
          {% else %}
            <span class="badge bg-success">已恢复</span>
          {% endif %}
        </td>
        <td>{{ a.created_at|date:"Y-m-d H:i:s" }}</td>
        <td class="text-truncate" style="max-width:300px;">{{ a.message }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<p class="text-muted">暂无报警数据。</p>
{% endif %}
{% endblock %}
