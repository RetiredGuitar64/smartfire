{% extends "base.html" %}
{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <h3 class="m-0">设备列表</h3>
  <div>
    <form class="d-inline" method="get" action=".">
      <input type="text" name="q" value="{{ q|default:'' }}" class="form-control form-control-sm d-inline-block" style="width:200px" placeholder="搜索设备...">
    </form>
    {% if request.user.is_authenticated and perms.devices.add_device %}
      <a class="btn btn-success btn-sm ms-2" href="{% url 'devices:add' %}">+ 新增设备</a>
    {% endif %}
  </div>
</div>

<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>ID</th><th>名称</th><th>设备类型</th><th>安装位置</th><th>状态</th>
        {% if request.user.is_authenticated and perms.devices.change_device or perms.devices.delete_device %}
          <th style="width:140px">操作</th>
        {% endif %}
      </tr>
    </thead>
    <tbody>
      {% for d in devices %}
      <tr>
        <td>{{ d.id }}</td>
        <td>{{ d.name }}</td>
        <td>{% firstof d.device_type d.type d.category "" %}</td>
        <td>{% firstof d.location d.place d.room "" %}</td>
        <td>{% firstof d.status d.state "" %}</td>
        {% if request.user.is_authenticated and perms.devices.change_device or perms.devices.delete_device %}
        <td>
          {% if perms.devices.change_device %}
            <a class="btn btn-sm btn-outline-primary" href="{% url 'devices:edit' d.id %}">编辑</a>
          {% endif %}
          {% if perms.devices.delete_device %}
            <a class="btn btn-sm btn-outline-danger" href="{% url 'devices:delete' d.id %}">删除</a>
          {% endif %}
        </td>
        {% endif %}
      </tr>
      {% empty %}
      <tr><td colspan="6" class="text-center text-muted">暂无设备</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
