{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm" style="max-width:860px;margin:0 auto;">
  <div class="card-header bg-white">
    <h4 class="m-0">{% if object %}编辑设备{% else %}新增设备{% endif %}</h4>
  </div>
  <div class="card-body">
    {% if form.errors %}
      <div class="alert alert-danger">请检查表单中的错误。</div>
    {% endif %}
    <form method="post" novalidate>
      {% csrf_token %}
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">名称<span class="text-danger">*</span></label>
          {{ form.name }}
        </div>
        <div class="col-md-6">
          <label class="form-label">设备类型<span class="text-danger">*</span></label>
          {% firstof form.device_type form.type form.category as _dtype %}
          {{ _dtype }}
        </div>
        <div class="col-md-6">
          <label class="form-label">安装位置</label>
          {% firstof form.location form.place form.room as _loc %}
          {{ _loc }}
        </div>
        <div class="col-md-6">
          <label class="form-label">状态</label>
          {% firstof form.status form.state as _st %}
          {{ _st }}
        </div>
      </div>

      {% comment %} 渲染其它未列出的字段 {% endcomment %}
      {% for f in form.hidden_fields %}{{ f }}{% endfor %}
      <div class="mt-3">
        {% for f in form.visible_fields %}
          {% if f.name not in ('name','device_type','type','category','location','place','room','status','state') %}
            <div class="mb-2">
              <label class="form-label">{{ f.label }}</label>
              {{ f }}
              {% if f.help_text %}<div class="form-text text-muted">{{ f.help_text }}</div>{% endif %}
              {% if f.errors %}<div class="text-danger small">{{ f.errors }}</div>{% endif %}
            </div>
          {% endif %}
        {% endfor %}
      </div>

      <div class="d-flex justify-content-end mt-4">
        <a href="{% url 'devices:list' %}" class="btn btn-outline-secondary me-2">返回</a>
        <button type="submit" class="btn btn-primary">保存</button>
      </div>
    </form>
  </div>
</div>

<script>
  // 自动补齐表单控件样式
  (function(){
    document.querySelectorAll('input[type=text],input[type=number],input[type=datetime-local],textarea,select').forEach(function(el){
      if(!el.className || !/form-(control|select)/.test(el.className)){
        if(el.tagName === 'SELECT'){ el.classList.add('form-select'); }
        else { el.classList.add('form-control'); }
      }
    });
  })();
</script>
{% endblock %}
